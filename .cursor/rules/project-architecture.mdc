---
description: Project architecture, stack, navigation, persistence, and key data types
alwaysApply: true
---

# Project Architecture

## Stack
Scala 3 + Scala.js + **Tyrian** (Elm-style SPA) + **Circe** (JSON) + **Cats Effect IO**. Parcel for local dev, GitHub Pages for deploy.

## Entry Point
`App` (`App.scala`) is a `TyrianIOApp`. Root model: `RootModel(registry, currentScreenId, currentModel: Any)`. Screens are type-erased; each has `Model`, `Msg`, `init`, `update`, `view`, `wrapMsg`.

## Navigation
Screens emit `NavigateNext(screenId, Some(ScreenOutput))`. Root calls target screen's `init(Some(output))` and replaces `currentModel`. No URL routing (`Routing.none`).

## Persistence
Lists use **LocalStorage** via `LocalStorageUtils` (`loadList`/`saveList` with `StorageKeys` in `StoredEntities.scala`).

## Key Data Types
| Type | File | Purpose |
|---|---|---|
| `StoredNote` | `StoredEntities.scala` | id, name, content. Demo CRUD entity. |

## Persistence (Circe)
All stored entities use `deriveEncoder`/`deriveDecoder` from circe-generic. `Option` fields are optional in JSON (absent -> `None`). If backward compat is ever needed, use custom decoders with `withX.or(withoutX)`.

## Where Things Live
| Concern | Location |
|---|---|
| Screen IDs, ScreenOutput | `Screen.scala` |
| Stored entities, StorageKeys, Circe decoders | `StoredEntities.scala` |
| NES.css class names | `common/nescss/NesCss.scala` |
| Layout, gallery cards | `css/style.css` |
| PDF generation | `common/pdf/Instruction.scala`, `common/pdf/JsPDF.scala`, `common/pdf/PdfUtils.scala` |
| Gallery empty state | `screens/GalleryEmptyState.scala` |
| Shared screen header | `screens/ScreenHeader.scala` |
